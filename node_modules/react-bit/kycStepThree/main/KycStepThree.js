import React from 'react'
import './KycStepThree.css'
import { Card } from '../../../hocs' 
import { useCamera } from '../../../utils/customHooks'; 
import ImageMode from '../imageMode/ImageMode';
import VideoMode from '../videoMode/VideoMode'; 
import { useDispatch, useSelector } from 'react-redux';
import { uploadImage } from '../../../redux/actions/Actions';

const KycStepThree = (props) => {
  const {
    handleClick = () => { }
  } = { ...props };
  const _handleClick = (type) => {
    if (type == 'close') {
      handleClick(2);
    }
  }
  const state = useSelector(state=>state.common);
  const {
    uploadedImages
  } = {
    ...state
  }
  const { values, actions } = useCamera(); // initialize it 
  const dispatch = useDispatch();
  const {
    imgSrc
  } = { ...values };
  const {
    capture,
  } = { ...actions }
  return (
    <Card
      bodyCls={'video-card'}
    >
      {
        imgSrc  ||  uploadedImages.selfie
          ? 
          <ImageMode
            capture={(shouldCapture, isDetected, ref) => {
              
              capture(shouldCapture, isDetected, ref,true)
              dispatch(uploadImage({ body: { photo: imgSrc, type: 'base64' } }));
              handleClick(4);

            }}
            imgSrc={imgSrc || uploadedImages.selfie}
            _handleClick={() => _handleClick('close')}
          />
          :
          <VideoMode
            capture={(shouldCapture, isDetected, ref) => {
              capture(shouldCapture, isDetected, ref,false)
            }}
            _handleClick={() => _handleClick('close')}
          />
      }
    </Card>
  )
}

export default KycStepThree